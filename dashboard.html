<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SplitBillEz</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="images/splitbillez_favicon.png">
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body onload="initWeb3()">
    <header>
        <div class="header-container">
            <img src="images/splitbillez_logo.png" alt="SplitBillEz Logo" class="logo">
            <nav>
                <a href="index.html">Home</a>
                <a href="dashboard.html">Dashboard</a>
                <a href="add-expense.html">Add Expense</a>
            </nav>
            <button class="metamask-button" onclick="initWeb3()">Connect with MetaMask</button>
        </div>
    </header>
    <main>
        <section>
            <h2>Your Groups</h2>
            <div class="group">
                <h3>Trip to Goa (ID: 0)</h3>
                <p>You owe Alice 500 SHM.</p>
                <button onclick="settleUp(0, '0x742d35Cc6634C0532925a3b8D7aBFAb7cD5bE4c4', 500000000000000000000n)">Settle Up</button>
            </div>
            <div class="group">
                <h3>Dinner Party (ID: 1)</h3>
                <p>You owe Charlie 150 SHM.</p>
                <button onclick="settleUp(1, '0x1234567890123456789012345678901234567890', 150000000000000000000n)">Settle Up</button>
            </div>
        </section>
    </main>
    <footer>
        <p>Â© 2025 SplitBillEz Powered by Shardeum</p>
        <div class="social-links">
            <a href="https://discord.com/invite/shardeum" target="_blank" rel="nofollow">
                <img src="images/discord.svg" alt="Discord" class="social-icon">
            </a>
            <a href="https://github.com/BrunoMarshall/SplitBillEz" target="_blank" rel="nofollow">
                <img src="images/github.svg" alt="GitHub" class="social-icon">
            </a>
            <a href="https://www.linkedin.com/company/shardeum/" target="_blank" rel="nofollow">
                <img src="images/linkedin.svg" alt="LinkedIn" class="social-icon">
            </a>
            <a href="https://t.me/shardeum" target="_blank" rel="nofollow">
                <img src="images/telegram.svg" alt="Telegram" class="social-icon">
            </a>
            <a href="https://x.com/shardeum" target="_blank" rel="nofollow">
                <img src="images/twitter.svg" alt="X" class="social-icon">
            </a>
            <a href="https://www.youtube.com/@shardeum" target="_blank" rel="nofollow">
                <img src="images/youtube.svg" alt="YouTube" class="social-icon">
            </a>
        </div>
    </footer>
    <script src="js/app.js"></script>
    <script>
        async function settleUp(groupId, toAddress, amountWei) {
            if (!window.getContract() || !window.getAccount()) {
                alert('Connect wallet first!');
                return;
            }
            try {
                // Step 1: Native SHM transfer
                const txHash1 = await window.web3.eth.sendTransaction({
                    from: window.getAccount(),
                    to: toAddress,
                    value: amountWei
                });
                
                // Step 2: Record settlement on-chain
                const txHash2 = await window.getContract().methods.settleDebt(groupId, toAddress, amountWei).send({ from: window.getAccount() });
                
                alert(`Settled ${web3.utils.fromWei(amountWei, 'ether')} SHM!\nTransfer Tx: https://explorer-unstable.shardeum.org/tx/${txHash1.transactionHash}\nRecord Tx: https://explorer-unstable.shardeum.org/tx/${txHash2.transactionHash}`);
                
                // Update UI
                event.target.disabled = true;
                event.target.textContent = 'Settled';
                event.target.previousElementSibling.textContent = `Settled with ${event.target.previousElementSibling.textContent.split(' ')[2]}`;
            } catch (error) {
                alert('Error: ' + error.message + '\nEnsure you have enough SHM for gas/transfer!');
            }
        }
    </script>
</body>
</html>